services:
  hydravpn:
    build: .
    container_name: hydravpn-server
    restart: unless-stopped

    # Required capabilities for TUN/TAP and iptables
    cap_add:
      - NET_ADMIN
      - SYS_MODULE

    # Access to TUN device
    devices:
      - /dev/net/tun:/dev/net/tun

    # Host networking for proper NAT (traffic routing)
    network_mode: host

    # Note: ip_forward is set in docker-entrypoint.sh
    # sysctls not allowed with network_mode: host

    # Health check
    healthcheck:
      test: [ "CMD", "nc", "-z", "localhost", "8443" ]
      interval: 30s
      timeout: 10s
      retries: 3
