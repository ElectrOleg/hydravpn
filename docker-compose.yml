version: '3.8'

services:
  hydravpn:
    build: .
    container_name: hydravpn-server
    restart: unless-stopped

    # Required capabilities for TUN/TAP and iptables
    cap_add:
      - NET_ADMIN
      - SYS_MODULE

    # Access to TUN device
    devices:
      - /dev/net/tun:/dev/net/tun

    # Host networking for proper NAT (traffic routing)
    network_mode: host

    # Sysctls (backup, also set in entrypoint)
    sysctls:
      - net.ipv4.ip_forward=1

    # Health check
    healthcheck:
      test: [ "CMD", "nc", "-z", "localhost", "8443" ]
      interval: 30s
      timeout: 10s
      retries: 3
